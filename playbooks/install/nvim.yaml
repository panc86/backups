---
- name: Install NeoVim to current host
  hosts: localhost
  become: true
  vars:
    release: v0.11.4
    checksum: sha256:79e7e160f9505819a5e12f3d9366be94213f5309fb912ef4ef3af52df3982977

  tasks:
    - name: Creates NeoVim directory
      ansible.builtin.file:
        path: /opt/nvim
        state: directory

    - name: "Install NeoVim {{ release }} AppImage"
      ansible.builtin.get_url:
        url: "https://github.com/neovim/neovim/releases/download/{{ release }}/nvim-linux-x86_64.appimage"
        dest: /opt/nvim/nvim.appimage
        mode: 0755
        # override the file if dest is not a directory
        force: true
        checksum: "{{ checksum }}"

    - name: Extract NeoVim Binary
      # If your system does not have FUSE you can extract the appimage
      ansible.builtin.shell:
        cmd: cd /opt/nvim && ./nvim.appimage --appimage-extract

    - name: Create NeoVim Symlink
      ansible.builtin.shell:
        cmd: ln -sf /opt/nvim/squashfs-root/usr/bin/nvim /usr/bin/nvim
